<div class="bg-slate-800 p-6 rounded-2xl shadow-xl w-full max-w-sm border border-slate-700">
    <h2 class="text-blue-400 font-bold mb-4">設備連線控制</h2>
    
    <div class="mb-6">
        <label class="block text-xs text-slate-400 mb-1">目標設備 MAC 位址</label>
        <input type="text" id="target-mac" placeholder="例如: AABBCCDDEEFF" 
               class="w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-orange-400 font-mono focus:ring-2 focus:ring-blue-500 outline-none">
    </div>

    <div class="bg-slate-900 p-4 rounded-lg mb-6 text-center">
        <div class="text-slate-500 text-xs mb-1">目前該設備溫度</div>
        <div id="temp-val" class="text-5xl font-black text-white">--</div>
    </div>

    <div class="grid grid-cols-2 gap-4">
        <button onclick="controlDevice('ON')" class="bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold transition-all">開啟</button>
        <button onclick="controlDevice('OFF')" class="bg-red-600 hover:bg-red-500 py-3 rounded-xl font-bold transition-all">關閉</button>
    </div>
</div>

<script>
    // 萬用訂閱：接收 pony/esp32/ 底下的所有設備資料
    client.on('connect', () => {
        client.subscribe("pony/esp32/+/temp");
    });

    client.on('message', (topic, message) => {
        const parts = topic.split('/');
        const incomingMAC = parts[2]; // 取得發送資料的設備 MAC
        const currentInputMAC = document.getElementById('target-mac').value.trim().toUpperCase();

        // 只有當「發送資料的設備」等於「目前輸入的 MAC」時，才更新畫面
        if (incomingMAC === currentInputMAC) {
            document.getElementById('temp-val').innerText = message.toString();
        }
    });

    function controlDevice(cmd) {
        const mac = document.getElementById('target-mac').value.trim().toUpperCase();
        if (!mac) {
            alert("請先輸入設備 MAC 位址");
            return;
        }
        // 動態組合成該設備的控制主題
        const topic = `pony/esp32/${mac}/light`;
        client.publish(topic, cmd);
        console.log(`對設備 ${mac} 發送指令: ${cmd}`);
    }
</script>
